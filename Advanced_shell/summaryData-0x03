#!/bin/bash
# Generate Pokemon data summary report

INPUT_DIR="pokemon_data"
OUTPUT_CSV="pokemon_report.csv"

# Check if directory exists
if [ ! -d "$INPUT_DIR" ]; then
    echo "Error: $INPUT_DIR directory not found!"
    echo "Please run batchProcessing-0x02 first to fetch Pokemon data."
    exit 1
fi

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_CSV"

# Extract data from each JSON file
for json_file in "$INPUT_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        name=$(jq -r '.name' "$json_file" | sed 's/\b\(.\)/\u\1/')
        height=$(jq -r '.height' "$json_file" | awk '{printf "%.1f", $1/10}')
        weight=$(jq -r '.weight' "$json_file" | awk '{printf "%.1f", $1/10}')
        
        echo "$name,$height,$weight" >> "$OUTPUT_CSV"
    fi
done

# Display the CSV
echo "CSV Report generated at: $OUTPUT_CSV"
echo ""
cat "$OUTPUT_CSV"
echo ""

# Calculate averages using awk
awk -F',' 'NR>1 {
    sum_height += $2; 
    sum_weight += $3; 
    count++
} 
END {
    if (count > 0) {
        printf "Average Height: %.2f m\n", sum_height/count;
        printf "Average Weight: %.2f kg\n", sum_weight/count;
    }
}' "$OUTPUT_CSV"
